<!doctype html>
<html lang="cs">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Výpočet prodeje – vánoční stromky</title>
<style>
  :root{
    --bg:#06140e; --text:#e8f5ee; --muted:#9bc7b2;
    --card:#0a1c14; --line:#133322;
    --btn:#0e2a1d; --btn-accent:#29c374; --btn-accent-2:#1ea663;

    /* Barvy kategorií (světlé řádky) */
    --smrk:#e6f5e9; --borovice:#e0f2e6; --jedle:#dff6ea; --kvetinac:#e6f1fb;
    --stojan:#eef1f4; --haluzimelo:#fff8d9; --sluzby:#efe5da; --kusy:#ffe9d6;
    --akce:var(--jedle); --treefood:#efe6ff; --text-dark:#0b1a12;

    /* UI */
    --qty-btn:38px;          /* základní velikost tlačítek +/- */
    --mark-saved:#29c374;    /* lišta pro uložený (nenulový) záznam */
    --mark-active:#ffd166;   /* obrys pro právě upravovaný řádek */
  }

  *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--text);font:16px/1.45 system-ui,Segoe UI,Roboto,Arial,sans-serif}
  .wrap{max-width:1100px;margin:14px auto;padding:0 12px}
  h1{margin:0 0 12px;font-size:1.6rem}
  .muted{color:var(--muted)}
  .card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:14px;margin:10px 0}
  .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-variant-numeric: tabular-nums;}

  /* KPI */
  .kpis{display:grid;gap:8px}
  @media(min-width:720px){.kpis{grid-template-columns:repeat(2,1fr)}}
  @media(min-width:1100px){.kpis{grid-template-columns:repeat(3,1fr)}}
  .kpi{background:#092416;border:1px solid var(--line);border-radius:14px;padding:10px}
  .kpi h3{margin:0 0 6px;font-size:.95rem;color:var(--muted)}
  .kpi .v{font-size:1.35rem;font-weight:900}

  /* Tabulka */
  .table{width:100%;border-collapse:collapse;table-layout:fixed}
  .table thead th{position:sticky;top:0;background:var(--card);z-index:2;color:var(--text);box-shadow:0 1px 0 var(--line)}
  .table th,.table td{border-bottom:1px solid var(--line);padding:8px;text-align:right;vertical-align:middle}
  .table th:first-child,.table td:first-child{text-align:left}
  .table tbody td{color:var(--text-dark)}
  .col-price,.col-sum{white-space:nowrap}   /* čísla se nelámou */

  /* Sloupce (desktop/tablet) */
  .col-id{width:10%}
  .col-name{width:auto}
  .col-price{width:15%}
  .col-qty{width:20%}
  .col-sum{width:20%}

  .rowid{display:inline-block;font-weight:700;background:#123624;color:#c6f6d5;padding:2px 8px;border-radius:999px}

  /* Barvy celých řádků dle kategorie */
  tr.row-smrk td{background:var(--smrk)}
  tr.row-borovice td{background:var(--borovice)}
  tr.row-jedle td{background:var(--jedle)}
  tr.row-kvetinac td{background:var(--kvetinac)}
  tr.row-stojan td{background:var(--stojan)}
  tr.row-haluzimelo td{background:var(--haluzimelo)}
  tr.row-sluzby td{background:var(--sluzby)}
  tr.row-kusy td{background:var(--kusy)}
  tr.row-akce td{background:var(--akce)}
  tr.row-treefood td{background:var(--treefood)}

  /* Hover celé řádky */
  .table tbody tr:hover td,
  .table tbody tr:focus-within td { background:#29c374!important; color:#fff!important }
  /* Ale input při hoveru zůstane čitelný */
  .table tbody tr:hover input,
  .table tbody tr:focus-within input { background:#f2f7f4!important; color:#111!important }

  /* Markery stavu řádku */
  .table tbody tr.mark-saved td{ box-shadow: inset 4px 0 var(--mark-saved); }
  .table tbody tr.mark-active td{ outline:2px solid var(--mark-active)!important; outline-offset:-2px; }

  /* Ovládání kusů – pružné, škáluje s buněčnou šířkou */
  .qtyctrl{
    display:grid;
    grid-template-columns: var(--qty-btn) minmax(44px,1fr) var(--qty-btn);
    gap:.35rem; align-items:center; justify-items:center;
    width:100%; max-width: clamp(140px, 32vw, 220px);
  }
  .qtyctrl .btn{
    width:var(--qty-btn); height:var(--qty-btn);
    border:1px solid var(--line); background:var(--btn); color:var(--text);
    border-radius:12px; font-size:1.05rem; font-weight:800; cursor:pointer;
    position:relative; user-select:none; -webkit-user-select:none;
  }
  .btn.plus{background:linear-gradient(0deg,var(--btn-accent-2),var(--btn-accent))}
  .btn.minus{background:#163a28}
  .btn:active{transform:scale(.98)}
  .qtyctrl .btn::before{content:""; position:absolute; inset:-6px;} /* větší touch plocha */
  .qty{
    width:100%; min-width:44px; height:var(--qty-btn);
    text-align:center; background:#f2f7f4; border:1px solid var(--line);
    color:var(--text-dark); border-radius:10px; font-weight:800;
  }

  .section-title{margin:0 0 8px;font-size:1.1rem}

  /* Mobil – vše v jednom řádku, zkrácené hlavičky */
  @media (max-width:640px){
    :root{ --qty-btn:28px; }
    .col-id{width:8%} .col-price{width:14%} .col-qty{width:17%} .col-sum{width:18%}
    .table th,.table td{padding:8px 6px; font-size:.95rem}
    .col-name{overflow:hidden; text-overflow:ellipsis; white-space:nowrap}
    .qty{font-size:16px} /* anti-zoom iOS */
    .qtyctrl{gap:.28rem; max-width:clamp(120px,38vw,170px)}
    /* zkrácené texty hlaviček */
    th.col-price::after{content:"Cena/ks"}
    th.col-sum::after{content:"Suma"}
    th.col-price,th.col-sum{color:transparent; position:relative}
    th.col-price::after,th.col-sum::after{
      color:var(--text); position:absolute; inset:0; display:flex; align-items:center; justify-content:flex-end; padding:0 6px;
    }
  }
  /* Ultra úzké – povol vodorovný posuv */
  @media (max-width:360px){ .table{ min-width:340px } }
</style>
</head>
<body>
<div class="wrap">
  <h1>Dnešní prodej</h1>

  <div class="card">
    <div class="kpis">
      <div class="kpi"><h3>Dnešní prodej</h3><div class="v mono" id="todaySales">0,00 Eur</div></div>
      <div class="kpi"><h3>Odevzdat do obálky</h3><div class="v mono" id="envelope">0,00 Eur</div></div>
      <div class="kpi"><h3>Co zůstává dnes prodejci</h3><div class="v mono" id="sellerKeep">0,00 Eur</div></div>

      <div class="kpi"><h3>Počet prodaných stromů</h3><div class="v mono" id="cntStromy">0</div></div>
      <div class="kpi"><h3>Počet prodaných květináčů</h3><div class="v mono" id="cntKvetinace">0</div></div>
      <div class="kpi"><h3>Počet prodaných stojanů</h3><div class="v mono" id="cntStojany">0</div></div>
      <div class="kpi"><h3>Počet prodaných služeb</h3><div class="v mono" id="cntSluzby">0</div></div>
    </div>
  </div>

  <div class="card">
    <div class="section-title">Seznam položek</div>
    <table class="table" id="tbl">
      <thead>
        <tr>
          <th class="col-id">ID</th>
          <th class="col-name">Název</th>
          <th class="col-price">Cena za kus (Eur)</th>
          <th class="col-qty">Prodané kusy</th>
          <th class="col-sum">Celková suma (Eur)</th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
  </div>
</div>

<script>
/* ====== POMOCNÉ FORMÁTOVÁNÍ (cs-CZ) ====== */
const fmtNum = (n)=> new Intl.NumberFormat('cs-CZ',{minimumFractionDigits:2,maximumFractionDigits:2}).format(n||0);
const fmtEur = (n)=> `${fmtNum(n)} Eur`;

/* ====== DATA (bez výpočtů měněných) ====== */
const ITEMS = [
  { id:'B',  name:'Smrek',          price:23.60, cat:'smrk' },
  { id:'C',  name:'Smrek',          price:39.90, cat:'smrk' },
  { id:'D',  name:'Borovice',       price:29.90, cat:'borovice' },
  { id:'E',  name:'Borovice',       price:39.90, cat:'borovice' },
  { id:'F',  name:'Borovice',       price:49.90, cat:'borovice' },
  { id:'G',  name:'Borovice',       price:59.90, cat:'borovice' },
  { id:'H',  name:'Jedľa Akcia',    price:16.50, cat:'jedle' },
  { id:'I',  name:'Jedľa Akcia',    price:23.30, cat:'jedle' },
  { id:'J',  name:'Jedľa Akcia',    price:29.90, cat:'jedle' },
  { id:'K',  name:'Jedľa Akcia',    price:36.40, cat:'jedle' },
  { id:'L',  name:'Jedľa Akcia',    price:43.40, cat:'jedle' },
  { id:'M',  name:'Jedľa Nordmann', price:49.90, cat:'jedle' },
  { id:'N',  name:'Jedľa Nordmann', price:59.90, cat:'jedle' },
  { id:'O',  name:'Jedľa Premium',  price:71.50, cat:'jedle' },
  { id:'P',  name:'Jedľa Premium',  price:85.50, cat:'jedle' },
  { id:'Q',  name:'Jedľa Premium',  price:99.50, cat:'jedle' },
  { id:'R',  name:'Jedľa Premium',  price:135.00, cat:'jedle' },
  { id:'S',  name:'Jedľa Premium',  price:165.00, cat:'jedle' },
  { id:'T',  name:'Květináč',       price:36.40, cat:'kvetinac' },
  { id:'Z',  name:'Květináč',       price:43.40, cat:'kvetinac' },
  { id:'AA', name:'Květináč',       price:49.90, cat:'kvetinac' },
  { id:'U',  name:'Stojan',         price:34.00, cat:'stojan' },
  { id:'V',  name:'Stojan',         price:46.00, cat:'stojan' },
  { id:'W',  name:'Stojan',         price:52.00, cat:'stojan' },
  { id:'X',  name:'Stojan',         price:65.00, cat:'stojan' },
  { id:'Y',  name:'Stojan',         price:83.00, cat:'stojan' },
  { id:'AB', name:'Haluz',          price:3.90,  cat:'haluzimelo' },
  { id:'AC', name:'Haluz',          price:4.90,  cat:'haluzimelo' },
  { id:'AD', name:'Imelo',          price:2.90,  cat:'haluzimelo' },
  { id:'AE', name:'Frézování',      price:1.90,  cat:'sluzby', toSeller:true },
  { id:'AF', name:'Balení',         price:1.90,  cat:'sluzby', toSeller:true },
  { id:'AG', name:'Kusy',           price:1.90,  cat:'kusy' },
  { id:'AH', name:'Akce',           price:12.90, cat:'akce' },
  { id:'AI', name:'Treefood',       price:1.50,  cat:'treefood' }
];

const tbody = document.getElementById('tbody');
const todaySalesEl = document.getElementById('todaySales');
const envelopeEl   = document.getElementById('envelope');
const keepEl       = document.getElementById('sellerKeep');
const cntStromyEl = document.getElementById('cntStromy');
const cntKvetinaceEl = document.getElementById('cntKvetinace');
const cntStojanyEl = document.getElementById('cntStojany');
const cntSluzbyEl = document.getElementById('cntSluzby');

const qty = {};     // id -> kusy

function trClass(cat){
  return ({
    smrk:'row-smrk', borovice:'row-borovice', jedle:'row-jedle',
    kvetinac:'row-kvetinac', stojan:'row-stojan',
    haluzimelo:'row-haluzimelo', sluzby:'row-sluzby',
    kusy:'row-kusy', akce:'row-akce', treefood:'row-treefood'
  })[cat] || '';
}

function qtyControl(initial, onChange){
  const wrap = document.createElement('div'); wrap.className='qtyctrl';
  const minus = document.createElement('button'); minus.className='btn minus'; minus.textContent='−';
  const inp = document.createElement('input'); inp.className='qty mono'; inp.type='text'; inp.value=initial; inp.inputMode='numeric';
  const plus = document.createElement('button'); plus.className='btn plus'; plus.textContent='+';

  minus.setAttribute('aria-label','Odebrat kus');
  plus.setAttribute('aria-label','Přidat kus');
  inp.setAttribute('title','Zadej počet kusů');
  minus.tabIndex=0; plus.tabIndex=0;

  const clean=v=>Math.max(0,parseInt((v+'').replace(/[^\d]/g,''),10)||0);
  const set=n=>{ inp.value=n; onChange(n); };
  minus.onclick=()=> set(Math.max(0, clean(inp.value)-1));
  plus.onclick =()=> set(clean(inp.value)+1);
  inp.addEventListener('input', ()=> set(clean(inp.value)));
  wrap.append(minus, inp, plus);
  return wrap;
}

function addRow(parent, cells){
  const tr=document.createElement('tr'); tr.innerHTML=cells; parent.appendChild(tr); return tr;
}

function build(){
  tbody.innerHTML='';
  ITEMS.forEach(it=>{
    qty[it.id]=0;
    const tr = addRow(tbody, `
      <td class="col-id"><span class="rowid mono">${it.id}</span></td>
      <td class="col-name">${it.name}</td>
      <td class="col-price mono">${fmtNum(it.price)}</td>
      <td class="col-qty" data-qty></td>
      <td class="col-sum mono" data-sum>${fmtNum(0)}</td>
    `);
    tr.className = trClass(it.cat);

    const qtyCell = tr.querySelector('[data-qty]');
    const sumCell = tr.querySelector('[data-sum]');

    const setSavedMark = (n)=>{
      if(n>0) tr.classList.add('mark-saved');
      else tr.classList.remove('mark-saved');
    };
    tr.addEventListener('focusin', ()=> tr.classList.add('mark-active'));
    tr.addEventListener('focusout', ()=> tr.classList.remove('mark-active'));

    qtyCell.appendChild(qtyControl(0, n=>{
      qty[it.id]=n;
      sumCell.textContent = fmtNum(n*it.price);
      setSavedMark(n);
      recalc();
    }));
    setSavedMark(0);
  });

  // Kliknutí na řádek -> fokus do jeho inputu (mimo tlačítka a input)
  document.querySelectorAll('#tbody tr').forEach(tr=>{
    tr.addEventListener('click',e=>{
      if(e.target.closest('.btn') || e.target.closest('.qty')) return;
      const inp=tr.querySelector('.qty'); if(inp){ inp.focus(); inp.select(); }
    });
  });

  // Press & hold pro +/− (rychlé přičítání/odčítání)
  const START=400, STEP=60, MIN=60;
  function hold(btn, fn){
    let t, d=START, down=false;
    const start=()=>{
      if(down) return; down=true; fn(); d=START;
      const loop=()=>{ if(!down) return; fn(); d=Math.max(MIN,d-STEP); t=setTimeout(loop,d); };
      t=setTimeout(loop,d);
    };
    const stop=()=>{down=false; clearTimeout(t);};
    btn.addEventListener('mousedown',start);
    btn.addEventListener('touchstart',start,{passive:true});
    ['mouseup','mouseleave','touchend','touchcancel'].forEach(ev=>btn.addEventListener(ev,stop));
  }
  document.querySelectorAll('.qtyctrl').forEach(w=>{
    const minus=w.querySelector('.btn.minus');
    const plus =w.querySelector('.btn.plus');
    const inp  =w.querySelector('.qty');
    const clean=v=>Math.max(0,parseInt((v+'').replace(/[^\d]/g,''),10)||0);
    hold(minus, ()=>{ inp.value = clean(inp.value)-1; inp.dispatchEvent(new Event('input')); });
    hold(plus , ()=>{ inp.value = clean(inp.value)+1; inp.dispatchEvent(new Event('input')); });
  });
}

function recalc(){
  let total=0, owner=0, seller=0;
  let cStromy=0, cKv=0, cSt=0, cSvc=0;

  ITEMS.forEach(it=>{
    const n=qty[it.id]||0, sub=n*it.price;
    total+=sub;
    if(it.toSeller){ seller+=sub; cSvc+=n; } else { owner+=sub; }
    if(['smrk','borovice','jedle'].includes(it.cat)) cStromy+=n;
    else if(it.cat==='kvetinac') cKv+=n;
    else if(it.cat==='stojan') cSt+=n;
  });

  todaySalesEl.textContent=fmtEur(total);
  envelopeEl.textContent=fmtEur(owner);
  keepEl.textContent=fmtEur(seller);

  cntStromyEl.textContent=String(cStromy);
  cntKvetinaceEl.textContent=String(cKv);
  cntStojanyEl.textContent=String(cSt);
  cntSluzbyEl.textContent=String(cSvc);
}

build();
recalc();

/* Vstup: limit 5 číslic a auto-select při fokusu */
document.addEventListener('input',e=>{
  if(e.target && e.target.classList.contains('qty')){
    e.target.value=(e.target.value+'').replace(/[^\d]/g,'').slice(0,5);
  }
});
document.addEventListener('focusin',e=>{
  if(e.target && e.target.classList.contains('qty')) e.target.select();
});
</script>
</body>
</html>
